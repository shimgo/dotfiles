# Fix PR Reviews

このコマンドは、現在のブランチのプルリクエストに対する未解決のレビューコメントを取得し、指摘事項を修正するためのインタラクティブなワークフローを提供します。

## 実行手順

### 1. PRレビューコメントの取得

まず、`gh` コマンドを使用して現在のブランチに関連するプルリクエストの未解決のレビューコメントをすべて取得してください。

```bash
# 現在のブランチ名を取得
current_branch=$(git branch --show-current)

# 現在のブランチのPRを取得
pr_number=$(gh pr list --head "$current_branch" --json number --jq '.[0].number')

# PRの未解決のレビュースレッドを取得（GraphQL APIを使用）
gh api graphql -f query='
query {
  repository(owner: "{owner}", name: "{repo}") {
    pullRequest(number: '$pr_number') {
      reviewThreads(first: 50) {
        nodes {
          isResolved
          comments(first: 10) {
            nodes {
              body
              author {
                login
              }
              path
              line
            }
          }
        }
      }
    }
  }
}' --jq '.data.repository.pullRequest.reviewThreads.nodes[] | select(.isResolved == false)'
```

未解決のレビューコメントを抽出し、整理して表示してください。各コメントには以下の情報を含めてください:
- コメントの原文
- コメント者
- 該当ファイル
- 該当行番号

### 2. 修正方法の確認

取得したすべての未解決のレビューコメントをユーザーに提示し、以下の選択肢から修正方法を選んでもらってください:

**オプション:**
- A: すべてのレビューコメントの指摘を一度に修正する
- B: 1つずつ確認しながら修正する

### 3A. すべて一度に修正する場合

ユーザーが「A: すべて一度に修正する」を選択した場合:

1. すべてのレビューコメントで指摘された事項を分析する
2. 各指摘に対する修正を一度に実行する
3. 修正内容をユーザーに報告し、確認を求める
4. 必要に応じて追加の調整を行う

### 3B. 1つずつ修正する場合

ユーザーが「B: 1つずつ修正する」を選択した場合:

1. **レビューコメントの提示**: 最初のレビューコメントを提示する
   - コメントの詳細を表示
   - 該当コードの現在の状態を表示

2. **修正するかの確認**: ユーザーに以下の選択肢を提示する
   - 修正する
   - スキップして次へ進む

3. **修正の実行** (ユーザーが「修正する」を選択した場合):
   - レビューコメントに基づいた修正を実施
   - 修正内容をユーザーに提示
   - 「この修正で問題ないですか?」と確認
     - 問題ない → 次のレビューコメントへ進む
     - 修正が必要 → 追加の調整を行う

4. **スキップ** (ユーザーが「スキップ」を選択した場合):
   - 次のレビューコメントへ進む

5. **繰り返し**: すべてのレビューコメントを処理するまで手順1-4を繰り返す

### 4. 完了

すべてのレビューコメントの処理が完了したら:
- 修正されたファイルの一覧を表示
- 修正内容のサマリーを提供
- 次のステップ(コミット、プッシュなど)を提案

## 注意事項

- レビューコメントの内容を正確に理解し、適切な修正を行ってください
- 修正が他の部分に影響を与える可能性がある場合は、ユーザーに警告してください
- コードの品質とプロジェクトのコーディング規約を維持してください
- 不明確なレビューコメントがある場合は、ユーザーに確認を求めてください

## 使用するGitHub CLIコマンド例

```bash
# PRの詳細とレビュー情報を取得
gh pr view <PR番号> --json reviews,comments,reviewThreads

# PRのファイル変更を確認
gh pr diff <PR番号>

# PRのステータスを確認
gh pr status
```
